{% extends "base.html" %}
{% block title %}Property Details{% endblock %}

{% block content %}

<div class="property-page">

    <!-- Centered Slider -->
    <div class="slider-wrapper">
        <div class="gallery-slider" id="full-slider">
            {% if property.images.all %}
                {% for img in property.images.all %}
                    <img src="{{ img.image.url }}" 
                         class="gallery-slide {% if forloop.first %}active{% endif %}">
                {% endfor %}
            {% endif %}

            {% if property.images.count > 1 %}
                <button class="gallery-btn prev">❮</button>
                <button class="gallery-btn next">❯</button>
            {% endif %}
        </div>
    </div>

    <!-- Premium Info Card -->
    <div class="property-detail-card premium-property-card">

        <h2 class="property-title">{{ property.title }}</h2>
        <p class="property-address">{{ property.address }}</p>

        <div class="property-meta-row">
            <span>{{ property.bedrooms }} Beds</span>
            <span class="meta-dot">•</span>
            <span>{{ property.bathrooms }} Baths</span>
            <span class="meta-dot">•</span>
            <span>{{ property.sqft }} SqFt</span>
        </div>

        <div class="property-price-pill">
            ${{ property.monthly_rent }}/month
        </div>

        <p class="property-description">{{ property.description|linebreaks }}</p>

        <div class="property-actions">
            {% if request.user == property.landlord or request.user.is_staff %}
                <a href="{% url 'rentals:property_update' property.pk %}" class="btn-outline small-btn">
                    Edit Property
                </a>

                <a href="{% url 'rentals:property_delete' property.pk %}" 
                   onclick="return confirm('Delete this property?')" 
                   class="btn-danger small-btn delete-btn">
                    Delete
                </a>
            {% endif %}

            {% if request.user.is_authenticated and request.user.profile.role == "TENANT" %}
                <a href="{% url 'rentals:apply' property.pk %}" class="btn-view-primary btn-apply">
                    Apply to Rent
                </a>
            {% endif %}
        </div>

    </div>
</div>

<script>
let slider = document.querySelector("#full-slider");
if (slider) {
    const slides = slider.querySelectorAll(".gallery-slide");
    const prev = slider.querySelector(".prev");
    const next = slider.querySelector(".next");
    let idx = 0;

    function show(i) {
        slides.forEach(s => s.classList.remove("active"));
        slides[i].classList.add("active");
    }

    if (prev && next && slides.length) {
        prev.onclick = () => {
            idx = (idx === 0) ? slides.length - 1 : idx - 1;
            show(idx);
        };
        next.onclick = () => {
            idx = (idx === slides.length - 1) ? 0 : idx + 1;
            show(idx);
        };
    }
}
</script>

{% endblock %}
